<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ì—ì´ì•„ì´ë°‹ - n8n Workflow Portfolio</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config = {
  theme: {
    extend: {
      colors: {
        brand: { 50:'#f3f0f8', 100:'#e0d9f0', 200:'#c4b8e0', 300:'#a78fcf', 400:'#8b74b8', 500:'#6c539f', 600:'#5a4488', 700:'#48366e', 800:'#2a1f42', 900:'#0f0a1a' },
        point: { 400:'#f6a48e', 500:'#f3886c', 600:'#e8734f' },
        surface: { 50:'#111111', 100:'#1a1a1a', 200:'#222222', 300:'#333333' }
      }
    }
  }
}
</script>
<style>
@import url('https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css');
*{font-family:'Pretendard','Inter',-apple-system,BlinkMacSystemFont,sans-serif;-webkit-font-smoothing:antialiased}
html{scroll-behavior:smooth}
.card-enter{animation:cardIn .5s cubic-bezier(.16,1,.3,1) both}
@keyframes cardIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}
.filter-btn.active{background:linear-gradient(135deg,#f3886c,#6c539f);color:#fff;box-shadow:0 4px 18px rgba(108,83,159,.4)}
.card-hover{transition:all .3s cubic-bezier(.4,0,.2,1);border:1px solid #222}
.card-hover:hover{transform:translateY(-6px);box-shadow:0 0 24px rgba(243,136,108,.15),0 20px 40px rgba(0,0,0,.4);border-color:#6c539f}
.tag{transition:all .2s}
.tag:hover{transform:scale(1.05)}
.search-glow:focus{box-shadow:0 0 0 3px rgba(108,83,159,.4)}
.img-placeholder{background:linear-gradient(135deg,#1a1028 0%,#0f0a1a 50%,#1a1028 100%);position:relative;overflow:hidden}
.img-placeholder::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(108,83,159,.15),transparent);animation:shimmer 2.5s infinite}
@keyframes shimmer{to{left:100%}}
.hero-gradient{background:linear-gradient(135deg,#000000 0%,#1a1028 40%,#2a1f42 100%)}
.stat-card{backdrop-filter:blur(12px);background:rgba(108,83,159,.1);border:1px solid rgba(108,83,159,.2)}
.badge-work{background:rgba(108,83,159,.2);color:#a78fcf}
.badge-marketing{background:rgba(243,136,108,.15);color:#f3886c}
.badge-content{background:rgba(52,211,153,.15);color:#34d399}
.badge-lab{background:rgba(243,136,108,.1);color:#f6a48e}
.node-tag{background:#1a1a1a;color:#888;font-size:11px;padding:3px 10px;border-radius:9999px;white-space:nowrap;border:1px solid #2a2a2a}
.node-tag-clickable{cursor:pointer;transition:background .2s,border-color .2s,color .2s}
.node-tag-clickable:hover{background:rgba(108,83,159,.2);border-color:rgba(108,83,159,.4);color:#a78fcf}
#labSection,#labGrid,#mainGrid{overflow:visible!important;max-height:none!important}
.gradient-title{background:linear-gradient(135deg,#f3886c,#6c539f);-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text}
@media(max-width:640px){
  .node-tag{font-size:10px;padding:2px 6px}
}
</style>
<link rel="stylesheet" href="/assets/css/lightbox.css">
</head>
<body class="bg-black text-gray-300">

<!-- ==================== HERO ==================== -->
<header class="hero-gradient text-white relative overflow-hidden">
  <div class="absolute inset-0 opacity-20">
    <div class="absolute top-20 left-10 w-72 h-72 bg-brand-500 rounded-full filter blur-3xl"></div>
    <div class="absolute bottom-10 right-20 w-96 h-96 bg-point-500 rounded-full filter blur-3xl opacity-40"></div>
  </div>
  <div class="relative max-w-7xl mx-auto px-6 py-20 md:py-28">
    <div class="text-center">
      <div class="inline-flex items-center gap-2 bg-white/5 backdrop-blur px-4 py-1.5 rounded-full text-sm mb-6 border border-white/10">
        <span class="w-2 h-2 bg-point-500 rounded-full animate-pulse"></span>
        <span id="heroCount">Â·Â·Â·</span>+ Workflows Automated
      </div>
      <h1 class="text-4xl md:text-6xl font-extrabold tracking-tight mb-4">
        <span class="gradient-title">ì‹¤ì‹œê°„ ìë™í™”</span><br>ì—”ì§„ë£¸
      </h1>
      <p class="text-lg md:text-xl text-gray-400 max-w-2xl mx-auto mb-10">
        AIì™€ ìë™í™”ë¡œ ë¹„ì¦ˆë‹ˆìŠ¤ í”„ë¡œì„¸ìŠ¤ë¥¼ í˜ì‹ í•©ë‹ˆë‹¤.<br>
        ì‹¤ë¬´ì— ì ìš© ì¤‘ì¸ <span class="text-point-500 font-semibold" id="heroCountText">Â·Â·Â·</span>ì˜ n8n ì›Œí¬í”Œë¡œìš°ë¥¼ ì†Œê°œí•©ë‹ˆë‹¤.
      </p>
      <div id="stats" class="flex flex-wrap justify-center gap-4 md:gap-6">
        <div class="stat-card rounded-2xl px-6 py-4 text-center min-w-[140px]" style="cursor:pointer" onclick="setFilter('all')">
          <div class="text-3xl font-bold text-white" id="statTotal">â€“</div>
          <div class="text-sm mt-1" style="color:#999">Total Workflows</div>
        </div>
        <div class="stat-card rounded-2xl px-6 py-4 text-center min-w-[140px]" style="background:rgba(108,83,159,.1);border-color:rgba(108,83,159,.3);cursor:pointer" onclick="setFilter('ì—…ë¬´ìë™í™”')">
          <div class="text-3xl font-bold text-white" id="statWork">0</div>
          <div class="text-sm mt-1 flex items-center justify-center gap-1.5" style="color:#a78fcf">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>
            ì—…ë¬´ìë™í™”
          </div>
        </div>
        <div class="stat-card rounded-2xl px-6 py-4 text-center min-w-[140px]" style="background:rgba(243,136,108,.1);border-color:rgba(243,136,108,.3);cursor:pointer" onclick="setFilter('ë§ˆì¼€íŒ…ìë™í™”')">
          <div class="text-3xl font-bold text-white" id="statMarketing">0</div>
          <div class="text-sm mt-1 flex items-center justify-center gap-1.5" style="color:#f3886c">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/></svg>
            ë§ˆì¼€íŒ…ìë™í™”
          </div>
        </div>
        <div class="stat-card rounded-2xl px-6 py-4 text-center min-w-[140px]" style="background:rgba(52,211,153,.1);border-color:rgba(52,211,153,.3);cursor:pointer" onclick="setFilter('ì»¨í…ì¸ ìë™í™”')">
          <div class="text-3xl font-bold text-white" id="statContent">0</div>
          <div class="text-sm mt-1 flex items-center justify-center gap-1.5" style="color:#34d399">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>
            ì»¨í…ì¸ ìë™í™”
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<!-- ==================== FILTER & SEARCH ==================== -->
<section class="sticky top-0 z-50 bg-black/80 backdrop-blur-xl border-b border-white/5">
  <div class="max-w-7xl mx-auto px-6 py-4">
    <div class="flex flex-col md:flex-row items-center gap-4">
      <!-- Filter -->
      <div class="flex flex-wrap gap-2" id="filterBtns">
        <button onclick="setFilter('all')" class="filter-btn active px-5 py-2 rounded-full text-sm font-semibold border border-white/10 transition-all" data-filter="all">
          ì „ì²´ <span class="ml-1 opacity-70" id="cntAll"></span>
        </button>
        <button onclick="setFilter('ì—…ë¬´ìë™í™”')" class="filter-btn px-5 py-2 rounded-full text-sm font-semibold border border-white/10 bg-white/5 text-gray-300 hover:bg-brand-500/15 hover:border-brand-500/30 transition-all" data-filter="ì—…ë¬´ìë™í™”">
          ì—…ë¬´ìë™í™” <span class="ml-1 opacity-70" id="cntWork"></span>
        </button>
        <button onclick="setFilter('ë§ˆì¼€íŒ…ìë™í™”')" class="filter-btn px-5 py-2 rounded-full text-sm font-semibold border border-white/10 bg-white/5 text-gray-300 hover:bg-point-500/15 hover:border-point-500/30 transition-all" data-filter="ë§ˆì¼€íŒ…ìë™í™”">
          ë§ˆì¼€íŒ…ìë™í™” <span class="ml-1 opacity-70" id="cntMarketing"></span>
        </button>
        <button onclick="setFilter('ì»¨í…ì¸ ìë™í™”')" class="filter-btn px-5 py-2 rounded-full text-sm font-semibold border border-white/10 bg-white/5 text-gray-300 hover:bg-emerald-500/15 hover:border-emerald-500/30 transition-all" data-filter="ì»¨í…ì¸ ìë™í™”">
          ì»¨í…ì¸ ìë™í™” <span class="ml-1 opacity-70" id="cntContent"></span>
        </button>
      </div>
      <!-- Search -->
      <div class="relative flex-1 max-w-md w-full">
        <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>
        <input id="searchInput" type="text" placeholder="ì›Œí¬í”Œë¡œìš° ì´ë¦„, ë…¸ë“œ, ID ê²€ìƒ‰ (ì˜ˆ: Airtable, Telegram...)" class="w-full pl-10 pr-4 py-2.5 rounded-full border border-white/10 bg-white/5 text-sm text-white placeholder-gray-500 focus:outline-none search-glow transition-all" oninput="applyFilters()">
      </div>
      <!-- Result count -->
      <div class="text-sm text-gray-500 whitespace-nowrap">
        <span id="resultCount">100</span>ê°œ í‘œì‹œ ì¤‘
      </div>
    </div>
  </div>
</section>

<!-- ==================== MAIN CARDS ==================== -->
<main class="max-w-7xl mx-auto px-6 sm:px-8 py-12 md:py-16">
  <!-- Loading Skeleton -->
  <div id="loadingSkeleton" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 mb-20">
    <div class="bg-[#111111] rounded-2xl overflow-hidden" style="height:420px"><div class="img-placeholder h-48"></div><div class="p-6"><div class="h-4 w-24 bg-white/5 rounded-full mb-3"></div><div class="h-5 w-3/4 bg-white/5 rounded mb-3"></div><div class="h-3 w-full bg-white/5 rounded mb-2"></div><div class="h-3 w-2/3 bg-white/5 rounded"></div></div></div>
    <div class="bg-[#111111] rounded-2xl overflow-hidden" style="height:420px"><div class="img-placeholder h-48"></div><div class="p-6"><div class="h-4 w-24 bg-white/5 rounded-full mb-3"></div><div class="h-5 w-3/4 bg-white/5 rounded mb-3"></div><div class="h-3 w-full bg-white/5 rounded mb-2"></div><div class="h-3 w-2/3 bg-white/5 rounded"></div></div></div>
    <div class="bg-[#111111] rounded-2xl overflow-hidden" style="height:420px"><div class="img-placeholder h-48"></div><div class="p-6"><div class="h-4 w-24 bg-white/5 rounded-full mb-3"></div><div class="h-5 w-3/4 bg-white/5 rounded mb-3"></div><div class="h-3 w-full bg-white/5 rounded mb-2"></div><div class="h-3 w-2/3 bg-white/5 rounded"></div></div></div>
    <div class="bg-[#111111] rounded-2xl overflow-hidden" style="height:420px"><div class="img-placeholder h-48"></div><div class="p-6"><div class="h-4 w-24 bg-white/5 rounded-full mb-3"></div><div class="h-5 w-3/4 bg-white/5 rounded mb-3"></div><div class="h-3 w-full bg-white/5 rounded mb-2"></div><div class="h-3 w-2/3 bg-white/5 rounded"></div></div></div>
    <div class="bg-[#111111] rounded-2xl overflow-hidden" style="height:420px"><div class="img-placeholder h-48"></div><div class="p-6"><div class="h-4 w-24 bg-white/5 rounded-full mb-3"></div><div class="h-5 w-3/4 bg-white/5 rounded mb-3"></div><div class="h-3 w-full bg-white/5 rounded mb-2"></div><div class="h-3 w-2/3 bg-white/5 rounded"></div></div></div>
    <div class="bg-[#111111] rounded-2xl overflow-hidden" style="height:420px"><div class="img-placeholder h-48"></div><div class="p-6"><div class="h-4 w-24 bg-white/5 rounded-full mb-3"></div><div class="h-5 w-3/4 bg-white/5 rounded mb-3"></div><div class="h-3 w-full bg-white/5 rounded mb-2"></div><div class="h-3 w-2/3 bg-white/5 rounded"></div></div></div>
  </div>
  <!-- Error State -->
  <div id="loadError" class="hidden col-span-full text-center py-20">
    <div class="text-5xl mb-4">&#9888;</div>
    <p class="text-gray-400 mb-4">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤</p>
    <button onclick="loadWorkflows()" class="px-6 py-2 rounded-full text-sm font-semibold border border-brand-500/30 text-brand-300 hover:bg-brand-500/10 transition-all">ë‹¤ì‹œ ì‹œë„</button>
  </div>
  <!-- Main Workflows -->
  <div id="mainGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8 mb-20"></div>

  <!-- Lab Section -->
  <div id="labSection" class="mt-12 mb-8">
    <div class="flex items-center gap-3 mb-8">
      <div class="flex items-center gap-2 bg-point-500/10 border border-point-500/20 rounded-full px-4 py-1.5">
        <span class="text-lg">ğŸ§ª</span>
        <span class="font-semibold text-point-500 text-sm">ì‹¤í—˜ì‹¤ / í…ŒìŠ¤íŠ¸</span>
      </div>
      <div class="flex-1 h-px bg-white/10"></div>
      <span class="text-sm text-point-400" id="labCount"></span>
    </div>
    <div id="labGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5"></div>
  </div>

  <!-- Archive Section (ì •ë¦¬ëŒ€ê¸°) â€” ê¸°ë³¸ ì ‘í˜ -->
  <div id="archiveSection" class="mt-12 mb-8" style="display:none">
    <div class="flex items-center gap-3 mb-8 cursor-pointer" onclick="toggleArchive()">
      <div class="flex items-center gap-2 bg-red-500/10 border border-red-500/20 rounded-full px-4 py-1.5">
        <span class="text-lg">ğŸ—‘</span>
        <span class="font-semibold text-red-400 text-sm">ì •ë¦¬ëŒ€ê¸°</span>
      </div>
      <div class="flex-1 h-px bg-white/10"></div>
      <span class="text-sm text-red-400" id="archiveCount"></span>
      <svg id="archiveChevron" class="w-5 h-5 text-red-400 transition-transform" style="transform:rotate(0deg)" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/></svg>
    </div>
    <div id="archiveGrid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-5" style="display:none"></div>
  </div>
</main>

<!-- ==================== FOOTER ==================== -->
<footer class="bg-black border-t border-white/5 text-white py-12">
  <div class="max-w-7xl mx-auto px-6 text-center">
    <div class="text-2xl font-bold mb-2 gradient-title">ì—ì´ì•„ì´ë°‹</div>
    <p class="text-brand-400 text-sm mb-6">AI &amp; Automation Solutions</p>
    <p class="text-gray-600 text-xs">&copy; 2026 ì—ì´ì•„ì´ë°‹. Built with n8n &amp; AI.</p>
  </div>
</footer>

<script>
// ============================================================
//  Supabase ë™ì  ë°ì´í„° ë¡œë”©
//  - ì›Œí¬í”Œë¡œìš° ë°ì´í„°ë¥¼ Supabaseì—ì„œ ì‹¤ì‹œê°„ìœ¼ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
//  - n8n ìë™ ë™ê¸°í™”ë¡œ ì¶”ê°€/ì‚­ì œ ì‹œ ìë™ ë°˜ì˜ë©ë‹ˆë‹¤.
// ============================================================
var SUPABASE_URL = 'https://jorrpxxxreisknvinsxg.supabase.co';
var SUPABASE_ANON_KEY = 'sb_publishable_T8RSfYdBZ0d2sROMQeHQWA_Qs6ztL4b';
var workflows = [];

// â”€â”€ ë…¸ë“œ íƒ€ì…ëª… ì •ë¦¬ ë§µ â”€â”€
var NODE_TYPE_MAP = {
  'n8n-nodes-base.httpRequest': 'HTTP Request',
  'n8n-nodes-base.code': 'Code',
  'n8n-nodes-base.set': 'Set',
  'n8n-nodes-base.if': 'If',
  'n8n-nodes-base.switch': 'Switch',
  'n8n-nodes-base.merge': 'Merge',
  'n8n-nodes-base.splitInBatches': 'SplitInBatches',
  'n8n-nodes-base.wait': 'Wait',
  'n8n-nodes-base.webhook': 'Webhook',
  'n8n-nodes-base.manualTrigger': 'Manual Trigger',
  'n8n-nodes-base.scheduleTrigger': 'Schedule Trigger',
  'n8n-nodes-base.formTrigger': 'Form Trigger',
  '@n8n/n8n-nodes-langchain.chatTrigger': 'Chat Trigger',
  'n8n-nodes-base.gmail': 'Gmail',
  'n8n-nodes-base.googleSheets': 'Google Sheets',
  'n8n-nodes-base.googleDrive': 'Google Drive',
  'n8n-nodes-base.slack': 'Slack',
  'n8n-nodes-base.telegram': 'Telegram',
  'n8n-nodes-base.telegramTrigger': 'Telegram Trigger',
  'n8n-nodes-base.airtable': 'Airtable',
  'n8n-nodes-base.notion': 'Notion',
  '@n8n/n8n-nodes-langchain.openAi': 'OpenAI',
  '@n8n/n8n-nodes-langchain.agent': 'AI Agent',
  '@n8n/n8n-nodes-langchain.memoryBufferWindow': 'Memory',
  'n8n-nodes-base.rssFeedRead': 'RSS Feed Read',
  'n8n-nodes-base.html': 'HTML',
  'n8n-nodes-base.htmlExtract': 'HTML Extract',
  'n8n-nodes-base.convertToFile': 'ConvertToFile',
  'n8n-nodes-base.extractFromFile': 'ExtractFromFile',
  'n8n-nodes-base.markdown': 'Markdown'
};

// ì œì™¸í•  ë¹„ê¸°ëŠ¥ ë…¸ë“œ íƒ€ì…
var EXCLUDED_NODE_TYPES = ['n8n-nodes-base.stickyNote', 'n8n-nodes-base.noOp'];

function extractNodeNames(nodesJson) {
  if (!nodesJson || !Array.isArray(nodesJson)) return [];
  var seen = {};
  var result = [];
  nodesJson.forEach(function(node) {
    var type = node.type || '';
    if (EXCLUDED_NODE_TYPES.indexOf(type) !== -1) return;
    // ë§µì—ì„œ ì°¾ê¸°, ì—†ìœ¼ë©´ íƒ€ì…ëª…ì—ì„œ ì¶”ì¶œ
    var name = NODE_TYPE_MAP[type];
    if (!name) {
      // '@n8n/n8n-nodes-langchain.openAi' â†’ 'openAi' â†’ 'OpenAi'
      // 'n8n-nodes-base.httpRequest' â†’ 'httpRequest' â†’ 'Http Request'
      var parts = type.split('.');
      var raw = parts[parts.length - 1] || type;
      name = raw.replace(/([A-Z])/g, ' $1').trim();
      name = name.charAt(0).toUpperCase() + name.slice(1);
    }
    if (!seen[name]) {
      seen[name] = true;
      result.push(name);
    }
  });
  return result;
}

// â”€â”€ Supabaseì—ì„œ ì›Œí¬í”Œë¡œìš° ë°ì´í„° ë¡œë“œ â”€â”€
function loadWorkflows() {
  var skeleton = document.getElementById('loadingSkeleton');
  var errorDiv = document.getElementById('loadError');
  var mainGrid = document.getElementById('mainGrid');
  if (skeleton) skeleton.style.display = '';
  if (errorDiv) errorDiv.classList.add('hidden');
  if (mainGrid) mainGrid.innerHTML = '';

  var headers = {
    'apikey': SUPABASE_ANON_KEY,
    'Authorization': 'Bearer ' + SUPABASE_ANON_KEY
  };

  // summary ì»¬ëŸ¼ì´ ì•„ì§ ì—†ì„ ìˆ˜ ìˆìœ¼ë¯€ë¡œ ë¨¼ì € í¬í•¨í•˜ì—¬ ì‹œë„, ì‹¤íŒ¨ ì‹œ ì œì™¸
  var cols = 'id,name,category,node_count,image_url,nodes,summary,publish_bool,updated_at,is_active_in_n8n';
  var apiUrl = SUPABASE_URL + '/rest/v1/n8n_workflows?select=' + cols + '&order=name.asc';

  fetch(apiUrl, { headers: headers })
    .then(function(res) {
      if (res.ok) return res.json();
      // summary ì»¬ëŸ¼ ì—†ìœ¼ë©´ ì œì™¸í•˜ê³  ì¬ì‹œë„
      var fallbackCols = 'id,name,category,node_count,image_url,nodes,publish_bool,updated_at,is_active_in_n8n';
      return fetch(SUPABASE_URL + '/rest/v1/n8n_workflows?select=' + fallbackCols + '&order=name.asc', { headers: headers })
        .then(function(r) { if (!r.ok) throw new Error('HTTP ' + r.status); return r.json(); });
    })
    .then(function(data) {
      workflows = data.map(function(row, i) {
        return {
          id: i + 1,
          n8nId: row.id,
          name: row.name || '',
          category: row.category || 'ë¯¸ë¶„ë¥˜',
          nodeCount: row.node_count || 0,
          nodes: extractNodeNames(row.nodes),
          summary: row.summary || '',
          img: row.image_url || '',
          isLab: false, // isLabItem() í•¨ìˆ˜ì˜ ì´ë¦„ ê¸°ë°˜ íœ´ë¦¬ìŠ¤í‹±ìœ¼ë¡œ íŒë³„
          updatedAt: row.updated_at || '',
          isArchived: row.is_active_in_n8n === false
        };
      });

      // ìŠ¤ì¼ˆë ˆí†¤ ìˆ¨ê¸°ê¸°
      if (skeleton) skeleton.style.display = 'none';

      // ì´ˆê¸°í™”
      init();
    })
    .catch(function(err) {
      console.error('Supabase ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', err);
      if (skeleton) skeleton.style.display = 'none';
      if (errorDiv) errorDiv.classList.remove('hidden');
    });
}

// ============================================================
//  ë Œë”ë§ ë¡œì§
// ============================================================
let currentFilter = 'all';

function isLabItem(w) {
  if (w.isLab) return true;
  const n = w.name.toLowerCase();
  const f = (w.file || '').toLowerCase();
  if (w.nodeCount <= 2) return true;
  if (n.includes('test') || n.includes('í…ŒìŠ¤íŠ¸') || f.includes('test')) return true;
  if (n.startsWith('my workflow')) return true;
  if (n === 'ã…ˆã…ˆ' || n === 'mytally') return true;
  if (n.includes('ë³µì‚¬ë³¸') || f.includes('(1)') || f.includes('_copy')) return true;
  if (n.includes('ë¯¸ì™„ì„±')) return true;
  return false;
}

function getBadgeClass(cat) {
  if (cat === 'ì—…ë¬´ìë™í™”') return 'badge-work';
  if (cat === 'ë§ˆì¼€íŒ…ìë™í™”') return 'badge-marketing';
  if (cat === 'ì»¨í…ì¸ ìë™í™”') return 'badge-content';
  return '';
}

function getCatIcon(cat) {
  if (cat === 'ì—…ë¬´ìë™í™”') return '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/></svg>';
  if (cat === 'ë§ˆì¼€íŒ…ìë™í™”') return '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5.882V19.24a1.76 1.76 0 01-3.417.592l-2.147-6.15M18 13a3 3 0 100-6M5.436 13.683A4.001 4.001 0 017 6h1.832c4.1 0 7.625-1.234 9.168-3v14c-1.543-1.766-5.067-3-9.168-3H7a3.988 3.988 0 01-1.564-.317z"/></svg>';
  if (cat === 'ì»¨í…ì¸ ìë™í™”') return '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"/></svg>';
  return '';
}

function getImgSrc(w) {
  if (w.img) return w.img;
  if (w.n8nId) return '/assets/img/workflow_' + w.n8nId + '.jpg';
  return '';
}

function renderMainCard(w, idx) {
  const imgSrc = getImgSrc(w);
  const topNodes = w.nodes.slice(0, 8);
  const moreCount = Math.max(0, w.nodes.length - 8);
  return `
  <div class="card-enter card-hover bg-[#111111] rounded-2xl flex flex-col" style="animation-delay:${Math.min(idx,15)*40}ms" data-id="${w.id}">
    <!-- Image / GIF Placeholder -->
    <div class="img-placeholder h-48 sm:h-44 flex items-center justify-center rounded-t-2xl" style="background:#0a0a0a">
      <img src="${imgSrc || 'data:,'}" alt="${w.name}" class="w-full h-full rounded-t-2xl" style="object-fit:contain;cursor:zoom-in" onclick="openLightbox(this.src)" onerror="this.style.display='none';this.nextElementSibling.style.display='flex'">
      <div class="text-center px-4" style="display:${imgSrc?'none':'flex'};flex-direction:column;align-items:center;justify-content:center;width:100%;height:100%">
        <div class="w-14 h-14 mx-auto mb-2 rounded-xl bg-white/5 backdrop-blur flex items-center justify-center text-2xl border border-white/10">
          ${w.category==='ì—…ë¬´ìë™í™”'?'&#9881;':w.category==='ë§ˆì¼€íŒ…ìë™í™”'?'&#128227;':'&#9997;'}
        </div>
        <p class="text-xs text-brand-400 font-medium">ì›Œí¬í”Œë¡œìš° ë¯¸ë¦¬ë³´ê¸° ì¤€ë¹„ì¤‘</p>
      </div>
    </div>
    <!-- Content -->
    <div class="p-6 flex flex-col flex-1">
      <div class="flex items-center gap-2 mb-3">
        <span class="${getBadgeClass(w.category)} text-xs font-semibold px-2.5 py-1 rounded-full inline-flex items-center gap-1">
          ${getCatIcon(w.category)} ${w.category}
        </span>
        <span class="text-xs text-gray-600 ml-auto">${w.nodeCount} nodes</span>
      </div>
      <h3 class="font-bold text-white mb-3 text-[15px] leading-snug">${w.name}</h3>
      ${w.n8nId ? `<p class="text-xs text-gray-600 mb-2 font-mono" style="margin-top:-8px">ID: ${w.n8nId}</p>` : ''}
      <p class="text-sm text-gray-400 leading-relaxed mb-5">${w.summary}</p>
      <div class="flex flex-wrap gap-1.5 mt-auto pt-4 border-t border-white/5">
        ${topNodes.map(n => `<span class="node-tag node-tag-clickable" title="í´ë¦­í•˜ë©´ ì´ ë…¸ë“œ í¬í•¨ ì›Œí¬í”Œë¡œìš°ë§Œ í‘œì‹œ">${n}</span>`).join('')}
        ${moreCount > 0 ? `<span class="node-tag" style="background:rgba(108,83,159,.2);color:#a78fcf;border-color:rgba(108,83,159,.3)">+${moreCount}</span>` : ''}
      </div>
      ${w.n8nId ? `<a href="https://n8n.rediace.com/workflow/${w.n8nId}" target="_blank" style="display:inline-flex;align-items:center;gap:6px;margin-top:16px;background:rgba(108,83,159,.12);color:#a78fcf;font-size:13px;font-weight:600;padding:8px 20px;border-radius:50px;text-decoration:none;border:1px solid rgba(108,83,159,.2);transition:background .3s,transform .3s" onmouseover="this.style.background='rgba(108,83,159,.25)'" onmouseout="this.style.background='rgba(108,83,159,.12)'">n8nìœ¼ë¡œ ì—´ê¸° <svg width='14' height='14' fill='none' stroke='currentColor' viewBox='0 0 24 24'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 8l4 4m0 0l-4 4m4-4H3'/></svg></a>` : ''}
    </div>
  </div>`;
}

function renderLabCard(w) {
  return `
  <div class="card-hover bg-[#0a0a0a] rounded-xl border border-white/5 p-5" data-id="${w.id}">
    <div class="flex flex-col gap-2">
      <div class="flex items-center gap-2">
        <span class="${getBadgeClass(w.category)} text-xs font-semibold px-2 py-0.5 rounded-full shrink-0">${w.category}</span>
        <span class="text-xs text-gray-600 ml-auto">${w.nodeCount} nodes</span>
      </div>
      <h4 class="font-semibold text-gray-300 text-sm leading-snug">${w.name}</h4>
      ${w.n8nId ? `<p class="text-xs text-gray-600 font-mono" style="margin-top:-2px">ID: ${w.n8nId}</p>` : ''}
      <p class="text-xs text-gray-500 leading-relaxed">${w.summary}</p>
      ${w.n8nId ? `<a href="https://n8n.rediace.com/workflow/${w.n8nId}" target="_blank" style="display:inline-flex;align-items:center;gap:5px;margin-top:4px;color:#a78fcf;font-size:12px;font-weight:600;text-decoration:none;transition:color .3s" onmouseover="this.style.color='#c4b5fd'" onmouseout="this.style.color='#a78fcf'">n8nìœ¼ë¡œ ì—´ê¸° <svg width='12' height='12' fill='none' stroke='currentColor' viewBox='0 0 24 24'><path stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M17 8l4 4m0 0l-4 4m4-4H3'/></svg></a>` : ''}
    </div>
  </div>`;
}

function applyFilters() {
  const query = document.getElementById('searchInput').value.toLowerCase().trim();

  const filtered = workflows.filter(w => {
    // Category filter
    if (currentFilter !== 'all' && w.category !== currentFilter) return false;
    // Search filter
    if (query) {
      const searchStr = (w.name + ' ' + w.nodes.join(' ') + ' ' + w.summary + ' ' + (w.file || '') + ' ' + w.n8nId).toLowerCase();
      return searchStr.includes(query);
    }
    return true;
  });

  // ì •ë¦¬ëŒ€ê¸°(n8n ì‚­ì œ) í•­ëª© ë¶„ë¦¬
  const activeItems = filtered.filter(w => !w.isArchived);
  const archiveItems = filtered.filter(w => w.isArchived);

  const mainItems = activeItems.filter(w => !isLabItem(w));
  const labItems = activeItems.filter(w => isLabItem(w));

  document.getElementById('mainGrid').innerHTML = mainItems.length
    ? mainItems.map((w, i) => renderMainCard(w, i)).join('')
    : `<div class="col-span-full text-center py-20 text-gray-600"><div class="text-5xl mb-4">&#128269;</div><p>ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤</p></div>`;

  document.getElementById('labGrid').innerHTML = labItems.map(w => renderLabCard(w)).join('');
  document.getElementById('labCount').textContent = `${labItems.length}ê°œ`;
  document.getElementById('labSection').style.display = labItems.length ? 'block' : 'none';

  document.getElementById('archiveGrid').innerHTML = archiveItems.map(w => renderLabCard(w)).join('');
  document.getElementById('archiveCount').textContent = `${archiveItems.length}ê°œ`;
  document.getElementById('archiveSection').style.display = archiveItems.length ? 'block' : 'none';

  document.getElementById('resultCount').textContent = mainItems.length + labItems.length;
}

function setFilter(cat) {
  currentFilter = cat;
  document.querySelectorAll('.filter-btn').forEach(btn => {
    if (btn.dataset.filter === cat) {
      btn.classList.add('active');
      btn.style.background = '';
      btn.style.color = '';
      btn.style.boxShadow = '';
    } else {
      btn.classList.remove('active');
      btn.style.background = 'rgba(255,255,255,0.05)';
      btn.style.color = '#d1d5db';
      btn.style.boxShadow = '';
    }
  });
  applyFilters();
}

// Init â€” Supabase ë°ì´í„° ë¡œë“œ ì™„ë£Œ í›„ í˜¸ì¶œ
function init() {
  var active = workflows.filter(function(w){ return !w.isArchived; });
  var total = active.length;
  var work = active.filter(function(w){ return w.category === 'ì—…ë¬´ìë™í™”'; }).length;
  var mkt = active.filter(function(w){ return w.category === 'ë§ˆì¼€íŒ…ìë™í™”'; }).length;
  var cnt = active.filter(function(w){ return w.category === 'ì»¨í…ì¸ ìë™í™”'; }).length;

  // Hero ì¹´ìš´í„° ì—…ë°ì´íŠ¸
  var heroCount = document.getElementById('heroCount');
  var heroCountText = document.getElementById('heroCountText');
  if (heroCount) heroCount.textContent = total;
  if (heroCountText) heroCountText.textContent = total + 'ê°œ';

  document.getElementById('statTotal').textContent = total;
  document.getElementById('statWork').textContent = work;
  document.getElementById('statMarketing').textContent = mkt;
  document.getElementById('statContent').textContent = cnt;
  document.getElementById('cntAll').textContent = total;
  document.getElementById('cntWork').textContent = work;
  document.getElementById('cntMarketing').textContent = mkt;
  document.getElementById('cntContent').textContent = cnt;

  applyFilters();
}

// ë…¸ë“œ íƒœê·¸ í´ë¦­ ì´ë²¤íŠ¸ (í•œ ë²ˆë§Œ ë“±ë¡)
document.addEventListener('click', function (e) {
  var tag = e.target.closest('.node-tag-clickable');
  if (!tag || tag.textContent.trim().startsWith('+')) return;
  var node = tag.textContent.trim();
  var searchInput = document.getElementById('searchInput');
  if (searchInput) {
    searchInput.value = node;
    searchInput.focus();
    applyFilters();
  }
});

// ì •ë¦¬ëŒ€ê¸° ì„¹ì…˜ í† ê¸€
function toggleArchive() {
  var grid = document.getElementById('archiveGrid');
  var chevron = document.getElementById('archiveChevron');
  if (grid.style.display === 'none') {
    grid.style.display = '';
    chevron.style.transform = 'rotate(180deg)';
  } else {
    grid.style.display = 'none';
    chevron.style.transform = 'rotate(0deg)';
  }
}

// í˜ì´ì§€ ë¡œë“œ ì‹œ Supabaseì—ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
loadWorkflows();

// Image Lightbox
function openLightbox(src) {
  if (!src || src === 'data:,') return;
  var overlay = document.getElementById('img-lightbox');
  if (!overlay) {
    overlay = document.createElement('div');
    overlay.id = 'img-lightbox';
    overlay.style.cssText = 'position:fixed;inset:0;z-index:9999;background:rgba(0,0,0,.92);backdrop-filter:blur(8px);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .25s;cursor:zoom-out';
    overlay.innerHTML = '<img style="max-width:95vw;max-height:90vh;object-fit:contain;border-radius:8px"><button style="position:absolute;top:20px;right:24px;color:rgba(255,255,255,.6);font-size:32px;background:none;border:none;cursor:pointer;line-height:1" aria-label="ë‹«ê¸°">&times;</button>';
    overlay.addEventListener('click', function(){ overlay.style.opacity='0'; overlay.style.pointerEvents='none'; document.body.style.overflow=''; });
    overlay.querySelector('img').addEventListener('click', function(e){ e.stopPropagation(); });
    document.addEventListener('keydown', function(e){ if(e.key==='Escape'){ overlay.style.opacity='0'; overlay.style.pointerEvents='none'; document.body.style.overflow=''; }});
    document.body.appendChild(overlay);
  }
  overlay.querySelector('img').src = src;
  overlay.style.opacity = '1';
  overlay.style.pointerEvents = 'auto';
  document.body.style.overflow = 'hidden';
}
</script>
</body>
<script src="/assets/js/lightbox.js"></script>
</html>
